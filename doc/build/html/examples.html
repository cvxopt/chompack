

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Examples &mdash; Chompack 2.3.0 documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
    <link rel="top" title="Chompack 2.3.0 documentation" href="index.html"/>
        <link rel="prev" title="Documentation" href="documentation.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        <a href="index.html" class="fa fa-home"> Chompack</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
        
            <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="license.html">Copyright and License</a></li>
<li class="toctree-l1"><a class="reference internal" href="install.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="install.html#installation-from-source">Installation from source</a></li>
<li class="toctree-l2"><a class="reference internal" href="install.html#python-only-installation">Python-only installation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="documentation.html">Documentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="documentation.html#quick-start">Quick start</a></li>
<li class="toctree-l2"><a class="reference internal" href="documentation.html#symbolic-factorization">Symbolic factorization</a></li>
<li class="toctree-l2"><a class="reference internal" href="documentation.html#chordal-sparse-matrices">Chordal sparse matrices</a></li>
<li class="toctree-l2"><a class="reference internal" href="documentation.html#numerical-computations">Numerical computations</a></li>
<li class="toctree-l2"><a class="reference internal" href="documentation.html#chordal-conversion">Chordal conversion</a></li>
<li class="toctree-l2"><a class="reference internal" href="documentation.html#auxiliary-routines">Auxiliary routines</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#sdp-conversion">SDP conversion</a></li>
<li class="toctree-l2"><a class="reference internal" href="#euclidean-distance-matrix-completion">Euclidean distance matrix completion</a></li>
<li class="toctree-l2"><a class="reference internal" href="#symbolic-factorization">Symbolic factorization</a></li>
</ul>
</li>
</ul>

        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">Chompack</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>Examples</li>
      <li class="wy-breadcrumbs-aside">
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            
  <div class="section" id="examples">
<h1>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h1>
<div class="section" id="sdp-conversion">
<h2>SDP conversion<a class="headerlink" href="#sdp-conversion" title="Permalink to this headline">¶</a></h2>
<p>This example demonstrates the SDP conversion method. We first generate a
random sparse SDP:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">cvxopt</span> <span class="k">import</span> <span class="n">matrix</span><span class="p">,</span> <span class="n">spmatrix</span><span class="p">,</span> <span class="n">sparse</span><span class="p">,</span> <span class="n">normal</span><span class="p">,</span> <span class="n">solvers</span><span class="p">,</span> <span class="n">blas</span>
<span class="kn">import</span> <span class="nn">chompack</span> <span class="k">as</span> <span class="nn">cp</span>
<span class="kn">import</span> <span class="nn">random</span>

<span class="c1"># Function for generating random sparse matrix</span>
<span class="k">def</span> <span class="nf">sp_rand</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">a</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generates an m-by-n sparse &#39;d&#39; matrix with round(a*m*n) nonzeros.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">m</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="k">return</span> <span class="n">spmatrix</span><span class="p">([],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">n</span><span class="p">))</span>
    <span class="n">nnz</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="n">m</span><span class="o">*</span><span class="n">n</span><span class="p">))),</span> <span class="n">m</span><span class="o">*</span><span class="n">n</span><span class="p">)</span>
    <span class="n">nz</span> <span class="o">=</span> <span class="n">matrix</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">m</span><span class="o">*</span><span class="n">n</span><span class="p">),</span> <span class="n">nnz</span><span class="p">),</span> <span class="n">tc</span><span class="o">=</span><span class="s1">&#39;i&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">spmatrix</span><span class="p">(</span><span class="n">normal</span><span class="p">(</span><span class="n">nnz</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">nz</span><span class="o">%</span><span class="n">m</span><span class="p">,</span> <span class="n">nz</span><span class="o">/</span><span class="n">m</span><span class="p">,</span> <span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">n</span><span class="p">))</span>

<span class="c1"># Generate random sparsity pattern and sparse SDP problem data</span>
<span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">m</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">200</span>
<span class="n">A</span> <span class="o">=</span> <span class="n">sp_rand</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="mf">0.015</span><span class="p">)</span> <span class="o">+</span> <span class="n">spmatrix</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span><span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">),</span><span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
<span class="n">I</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">tril</span><span class="p">(</span><span class="n">A</span><span class="p">)[:]</span><span class="o">.</span><span class="n">I</span>
<span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="o">/</span><span class="mi">50</span> <span class="c1"># each data matrix has 1/50 of total nonzeros in pattern</span>
<span class="n">Ig</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">Jg</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
    <span class="n">Ig</span> <span class="o">+=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">I</span><span class="p">,</span><span class="n">N</span><span class="p">))</span>
    <span class="n">Jg</span> <span class="o">+=</span> <span class="n">N</span><span class="o">*</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
<span class="n">G</span> <span class="o">=</span> <span class="n">spmatrix</span><span class="p">(</span><span class="n">normal</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Ig</span><span class="p">),</span><span class="mi">1</span><span class="p">),</span><span class="n">Ig</span><span class="p">,</span><span class="n">Jg</span><span class="p">,(</span><span class="n">n</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span><span class="n">m</span><span class="p">))</span>
<span class="n">h</span> <span class="o">=</span> <span class="n">G</span><span class="o">*</span><span class="n">normal</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">spmatrix</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span><span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">),</span><span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">))[:]</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">normal</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">dims</span> <span class="o">=</span>  <span class="p">{</span><span class="s1">&#39;l&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;q&#39;</span><span class="p">:[],</span> <span class="s1">&#39;s&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">n</span><span class="p">]};</span>
</pre></div>
</div>
<p>The problem can be solved using CVXOPT&#8217;s cone LP solver:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">prob</span> <span class="o">=</span> <span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">matrix</span><span class="p">(</span><span class="n">h</span><span class="p">),</span> <span class="n">dims</span><span class="p">)</span>
<span class="n">sol</span> <span class="o">=</span> <span class="n">solvers</span><span class="o">.</span><span class="n">conelp</span><span class="p">(</span><span class="o">*</span><span class="n">prob</span><span class="p">)</span>
<span class="n">Z1</span> <span class="o">=</span> <span class="n">matrix</span><span class="p">(</span><span class="n">sol</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">],</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">n</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span>     <span class="n">pcost</span>       <span class="n">dcost</span>       <span class="n">gap</span>    <span class="n">pres</span>   <span class="n">dres</span>   <span class="n">k</span><span class="o">/</span><span class="n">t</span>
 <span class="mi">0</span><span class="p">:</span> <span class="o">-</span><span class="mf">7.9591e+00</span> <span class="o">-</span><span class="mf">2.9044e+02</span>  <span class="mi">3</span><span class="n">e</span><span class="o">+</span><span class="mi">02</span>  <span class="mi">6</span><span class="n">e</span><span class="o">-</span><span class="mi">16</span>  <span class="mi">2</span><span class="n">e</span><span class="o">+</span><span class="mi">00</span>  <span class="mi">1</span><span class="n">e</span><span class="o">+</span><span class="mi">00</span>
 <span class="mi">1</span><span class="p">:</span> <span class="o">-</span><span class="mf">1.1826e+01</span> <span class="o">-</span><span class="mf">1.1054e+02</span>  <span class="mi">9</span><span class="n">e</span><span class="o">+</span><span class="mi">01</span>  <span class="mi">4</span><span class="n">e</span><span class="o">-</span><span class="mi">15</span>  <span class="mi">8</span><span class="n">e</span><span class="o">-</span><span class="mi">01</span>  <span class="mi">4</span><span class="n">e</span><span class="o">-</span><span class="mi">01</span>
 <span class="mi">2</span><span class="p">:</span> <span class="o">-</span><span class="mf">1.7892e+01</span> <span class="o">-</span><span class="mf">9.9108e+01</span>  <span class="mi">8</span><span class="n">e</span><span class="o">+</span><span class="mi">01</span>  <span class="mi">4</span><span class="n">e</span><span class="o">-</span><span class="mi">15</span>  <span class="mi">7</span><span class="n">e</span><span class="o">-</span><span class="mi">01</span>  <span class="mi">3</span><span class="n">e</span><span class="o">-</span><span class="mi">01</span>
 <span class="mi">3</span><span class="p">:</span> <span class="o">-</span><span class="mf">2.3947e+01</span> <span class="o">-</span><span class="mf">4.1603e+01</span>  <span class="mi">2</span><span class="n">e</span><span class="o">+</span><span class="mi">01</span>  <span class="mi">2</span><span class="n">e</span><span class="o">-</span><span class="mi">15</span>  <span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">01</span>  <span class="mi">8</span><span class="n">e</span><span class="o">-</span><span class="mi">02</span>
 <span class="mi">4</span><span class="p">:</span> <span class="o">-</span><span class="mf">2.4646e+01</span> <span class="o">-</span><span class="mf">3.7190e+01</span>  <span class="mi">1</span><span class="n">e</span><span class="o">+</span><span class="mi">01</span>  <span class="mi">3</span><span class="n">e</span><span class="o">-</span><span class="mi">15</span>  <span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">01</span>  <span class="mi">6</span><span class="n">e</span><span class="o">-</span><span class="mi">02</span>
 <span class="mi">5</span><span class="p">:</span> <span class="o">-</span><span class="mf">2.6001e+01</span> <span class="o">-</span><span class="mf">2.9393e+01</span>  <span class="mi">3</span><span class="n">e</span><span class="o">+</span><span class="mi">00</span>  <span class="mi">3</span><span class="n">e</span><span class="o">-</span><span class="mi">15</span>  <span class="mi">3</span><span class="n">e</span><span class="o">-</span><span class="mi">02</span>  <span class="mi">2</span><span class="n">e</span><span class="o">-</span><span class="mi">02</span>
 <span class="mi">6</span><span class="p">:</span> <span class="o">-</span><span class="mf">2.6000e+01</span> <span class="o">-</span><span class="mf">2.9051e+01</span>  <span class="mi">3</span><span class="n">e</span><span class="o">+</span><span class="mi">00</span>  <span class="mi">3</span><span class="n">e</span><span class="o">-</span><span class="mi">15</span>  <span class="mi">3</span><span class="n">e</span><span class="o">-</span><span class="mi">02</span>  <span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">02</span>
 <span class="mi">7</span><span class="p">:</span> <span class="o">-</span><span class="mf">2.6252e+01</span> <span class="o">-</span><span class="mf">2.6796e+01</span>  <span class="mi">6</span><span class="n">e</span><span class="o">-</span><span class="mi">01</span>  <span class="mi">2</span><span class="n">e</span><span class="o">-</span><span class="mi">15</span>  <span class="mi">5</span><span class="n">e</span><span class="o">-</span><span class="mi">03</span>  <span class="mi">3</span><span class="n">e</span><span class="o">-</span><span class="mi">03</span>
 <span class="mi">8</span><span class="p">:</span> <span class="o">-</span><span class="mf">2.6272e+01</span> <span class="o">-</span><span class="mf">2.6506e+01</span>  <span class="mi">2</span><span class="n">e</span><span class="o">-</span><span class="mi">01</span>  <span class="mi">3</span><span class="n">e</span><span class="o">-</span><span class="mi">15</span>  <span class="mi">2</span><span class="n">e</span><span class="o">-</span><span class="mi">03</span>  <span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">03</span>
 <span class="mi">9</span><span class="p">:</span> <span class="o">-</span><span class="mf">2.6288e+01</span> <span class="o">-</span><span class="mf">2.6345e+01</span>  <span class="mi">6</span><span class="n">e</span><span class="o">-</span><span class="mi">02</span>  <span class="mi">2</span><span class="n">e</span><span class="o">-</span><span class="mi">15</span>  <span class="mi">5</span><span class="n">e</span><span class="o">-</span><span class="mi">04</span>  <span class="mi">3</span><span class="n">e</span><span class="o">-</span><span class="mi">04</span>
<span class="mi">10</span><span class="p">:</span> <span class="o">-</span><span class="mf">2.6289e+01</span> <span class="o">-</span><span class="mf">2.6326e+01</span>  <span class="mi">4</span><span class="n">e</span><span class="o">-</span><span class="mi">02</span>  <span class="mi">3</span><span class="n">e</span><span class="o">-</span><span class="mi">15</span>  <span class="mi">3</span><span class="n">e</span><span class="o">-</span><span class="mi">04</span>  <span class="mi">2</span><span class="n">e</span><span class="o">-</span><span class="mi">04</span>
<span class="mi">11</span><span class="p">:</span> <span class="o">-</span><span class="mf">2.6291e+01</span> <span class="o">-</span><span class="mf">2.6296e+01</span>  <span class="mi">5</span><span class="n">e</span><span class="o">-</span><span class="mi">03</span>  <span class="mi">3</span><span class="n">e</span><span class="o">-</span><span class="mi">15</span>  <span class="mi">4</span><span class="n">e</span><span class="o">-</span><span class="mi">05</span>  <span class="mi">3</span><span class="n">e</span><span class="o">-</span><span class="mi">05</span>
<span class="mi">12</span><span class="p">:</span> <span class="o">-</span><span class="mf">2.6291e+01</span> <span class="o">-</span><span class="mf">2.6292e+01</span>  <span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">03</span>  <span class="mi">3</span><span class="n">e</span><span class="o">-</span><span class="mi">15</span>  <span class="mi">9</span><span class="n">e</span><span class="o">-</span><span class="mi">06</span>  <span class="mi">6</span><span class="n">e</span><span class="o">-</span><span class="mi">06</span>
<span class="mi">13</span><span class="p">:</span> <span class="o">-</span><span class="mf">2.6291e+01</span> <span class="o">-</span><span class="mf">2.6291e+01</span>  <span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">04</span>  <span class="mi">2</span><span class="n">e</span><span class="o">-</span><span class="mi">15</span>  <span class="mi">9</span><span class="n">e</span><span class="o">-</span><span class="mi">07</span>  <span class="mi">6</span><span class="n">e</span><span class="o">-</span><span class="mi">07</span>
<span class="mi">14</span><span class="p">:</span> <span class="o">-</span><span class="mf">2.6291e+01</span> <span class="o">-</span><span class="mf">2.6291e+01</span>  <span class="mi">9</span><span class="n">e</span><span class="o">-</span><span class="mi">06</span>  <span class="mi">2</span><span class="n">e</span><span class="o">-</span><span class="mi">15</span>  <span class="mi">8</span><span class="n">e</span><span class="o">-</span><span class="mi">08</span>  <span class="mi">5</span><span class="n">e</span><span class="o">-</span><span class="mi">08</span>
<span class="n">Optimal</span> <span class="n">solution</span> <span class="n">found</span><span class="o">.</span>
</pre></div>
</div>
<p>An alternative is to convert the sparse SDP into a block-diagonal SDP
using the conversion method and solve the converted problem using
CVXOPT:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">prob2</span><span class="p">,</span> <span class="n">blocks_to_sparse</span><span class="p">,</span> <span class="n">symbs</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">convert_conelp</span><span class="p">(</span><span class="o">*</span><span class="n">prob</span><span class="p">)</span>
<span class="n">sol2</span> <span class="o">=</span> <span class="n">solvers</span><span class="o">.</span><span class="n">conelp</span><span class="p">(</span><span class="o">*</span><span class="n">prob2</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span>     <span class="n">pcost</span>       <span class="n">dcost</span>       <span class="n">gap</span>    <span class="n">pres</span>   <span class="n">dres</span>   <span class="n">k</span><span class="o">/</span><span class="n">t</span>
 <span class="mi">0</span><span class="p">:</span> <span class="o">-</span><span class="mf">7.9953e+00</span> <span class="o">-</span><span class="mf">2.8985e+02</span>  <span class="mi">1</span><span class="n">e</span><span class="o">+</span><span class="mi">03</span>  <span class="mi">9</span><span class="n">e</span><span class="o">-</span><span class="mi">01</span>  <span class="mi">2</span><span class="n">e</span><span class="o">+</span><span class="mi">00</span>  <span class="mi">1</span><span class="n">e</span><span class="o">+</span><span class="mi">00</span>
 <span class="mi">1</span><span class="p">:</span> <span class="o">-</span><span class="mf">1.8054e+01</span> <span class="o">-</span><span class="mf">8.9659e+01</span>  <span class="mi">1</span><span class="n">e</span><span class="o">+</span><span class="mi">02</span>  <span class="mi">2</span><span class="n">e</span><span class="o">-</span><span class="mi">01</span>  <span class="mi">6</span><span class="n">e</span><span class="o">-</span><span class="mi">01</span>  <span class="mi">1</span><span class="n">e</span><span class="o">+</span><span class="mi">00</span>
 <span class="mi">2</span><span class="p">:</span> <span class="o">-</span><span class="mf">2.2574e+01</span> <span class="o">-</span><span class="mf">5.4864e+01</span>  <span class="mi">5</span><span class="n">e</span><span class="o">+</span><span class="mi">01</span>  <span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">01</span>  <span class="mi">3</span><span class="n">e</span><span class="o">-</span><span class="mi">01</span>  <span class="mi">7</span><span class="n">e</span><span class="o">-</span><span class="mi">01</span>
 <span class="mi">3</span><span class="p">:</span> <span class="o">-</span><span class="mf">2.4720e+01</span> <span class="o">-</span><span class="mf">3.4637e+01</span>  <span class="mi">1</span><span class="n">e</span><span class="o">+</span><span class="mi">01</span>  <span class="mi">3</span><span class="n">e</span><span class="o">-</span><span class="mi">02</span>  <span class="mi">8</span><span class="n">e</span><span class="o">-</span><span class="mi">02</span>  <span class="mi">2</span><span class="n">e</span><span class="o">-</span><span class="mi">01</span>
 <span class="mi">4</span><span class="p">:</span> <span class="o">-</span><span class="mf">2.5730e+01</span> <span class="o">-</span><span class="mf">2.8667e+01</span>  <span class="mi">4</span><span class="n">e</span><span class="o">+</span><span class="mi">00</span>  <span class="mi">9</span><span class="n">e</span><span class="o">-</span><span class="mi">03</span>  <span class="mi">2</span><span class="n">e</span><span class="o">-</span><span class="mi">02</span>  <span class="mi">4</span><span class="n">e</span><span class="o">-</span><span class="mi">02</span>
 <span class="mi">5</span><span class="p">:</span> <span class="o">-</span><span class="mf">2.6107e+01</span> <span class="o">-</span><span class="mf">2.6927e+01</span>  <span class="mi">1</span><span class="n">e</span><span class="o">+</span><span class="mi">00</span>  <span class="mi">3</span><span class="n">e</span><span class="o">-</span><span class="mi">03</span>  <span class="mi">7</span><span class="n">e</span><span class="o">-</span><span class="mi">03</span>  <span class="mi">9</span><span class="n">e</span><span class="o">-</span><span class="mi">03</span>
 <span class="mi">6</span><span class="p">:</span> <span class="o">-</span><span class="mf">2.6252e+01</span> <span class="o">-</span><span class="mf">2.6400e+01</span>  <span class="mi">2</span><span class="n">e</span><span class="o">-</span><span class="mi">01</span>  <span class="mi">5</span><span class="n">e</span><span class="o">-</span><span class="mi">04</span>  <span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">03</span>  <span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">03</span>
 <span class="mi">7</span><span class="p">:</span> <span class="o">-</span><span class="mf">2.6279e+01</span> <span class="o">-</span><span class="mf">2.6322e+01</span>  <span class="mi">5</span><span class="n">e</span><span class="o">-</span><span class="mi">02</span>  <span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">04</span>  <span class="mi">4</span><span class="n">e</span><span class="o">-</span><span class="mi">04</span>  <span class="mi">3</span><span class="n">e</span><span class="o">-</span><span class="mi">04</span>
 <span class="mi">8</span><span class="p">:</span> <span class="o">-</span><span class="mf">2.6289e+01</span> <span class="o">-</span><span class="mf">2.6295e+01</span>  <span class="mi">7</span><span class="n">e</span><span class="o">-</span><span class="mi">03</span>  <span class="mi">2</span><span class="n">e</span><span class="o">-</span><span class="mi">05</span>  <span class="mi">5</span><span class="n">e</span><span class="o">-</span><span class="mi">05</span>  <span class="mi">3</span><span class="n">e</span><span class="o">-</span><span class="mi">05</span>
 <span class="mi">9</span><span class="p">:</span> <span class="o">-</span><span class="mf">2.6291e+01</span> <span class="o">-</span><span class="mf">2.6293e+01</span>  <span class="mi">2</span><span class="n">e</span><span class="o">-</span><span class="mi">03</span>  <span class="mi">6</span><span class="n">e</span><span class="o">-</span><span class="mi">06</span>  <span class="mi">2</span><span class="n">e</span><span class="o">-</span><span class="mi">05</span>  <span class="mi">7</span><span class="n">e</span><span class="o">-</span><span class="mi">06</span>
<span class="mi">10</span><span class="p">:</span> <span class="o">-</span><span class="mf">2.6291e+01</span> <span class="o">-</span><span class="mf">2.6292e+01</span>  <span class="mi">5</span><span class="n">e</span><span class="o">-</span><span class="mi">04</span>  <span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">06</span>  <span class="mi">3</span><span class="n">e</span><span class="o">-</span><span class="mi">06</span>  <span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">06</span>
<span class="mi">11</span><span class="p">:</span> <span class="o">-</span><span class="mf">2.6291e+01</span> <span class="o">-</span><span class="mf">2.6291e+01</span>  <span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">04</span>  <span class="mi">2</span><span class="n">e</span><span class="o">-</span><span class="mi">07</span>  <span class="mi">6</span><span class="n">e</span><span class="o">-</span><span class="mi">07</span>  <span class="mi">2</span><span class="n">e</span><span class="o">-</span><span class="mi">07</span>
<span class="mi">12</span><span class="p">:</span> <span class="o">-</span><span class="mf">2.6291e+01</span> <span class="o">-</span><span class="mf">2.6291e+01</span>  <span class="mi">2</span><span class="n">e</span><span class="o">-</span><span class="mi">05</span>  <span class="mi">6</span><span class="n">e</span><span class="o">-</span><span class="mi">08</span>  <span class="mi">2</span><span class="n">e</span><span class="o">-</span><span class="mi">07</span>  <span class="mi">6</span><span class="n">e</span><span class="o">-</span><span class="mi">08</span>
<span class="mi">13</span><span class="p">:</span> <span class="o">-</span><span class="mf">2.6291e+01</span> <span class="o">-</span><span class="mf">2.6291e+01</span>  <span class="mi">5</span><span class="n">e</span><span class="o">-</span><span class="mi">06</span>  <span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">08</span>  <span class="mi">3</span><span class="n">e</span><span class="o">-</span><span class="mi">08</span>  <span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">08</span>
<span class="n">Optimal</span> <span class="n">solution</span> <span class="n">found</span><span class="o">.</span>
</pre></div>
</div>
<p>The solution to the original SDP can be found by mapping the
block-diagonal solution to a sparse positive semidefinite completable
matrix and computing a positive semidefinite completion:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="c1"># Map block-diagonal solution sol2[&#39;z&#39;] to a sparse positive semidefinite completable matrix</span>
<span class="n">blki</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">J</span><span class="p">,</span><span class="n">bn</span> <span class="o">=</span> <span class="n">blocks_to_sparse</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">Z2</span> <span class="o">=</span> <span class="n">spmatrix</span><span class="p">(</span><span class="n">sol2</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">][</span><span class="n">blki</span><span class="p">],</span><span class="n">I</span><span class="p">,</span><span class="n">J</span><span class="p">)</span>

<span class="c1"># Compute completion</span>
<span class="n">symb</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">symbolic</span><span class="p">(</span><span class="n">Z2</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">cp</span><span class="o">.</span><span class="n">maxcardsearch</span><span class="p">)</span>
<span class="n">Z2c</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">psdcompletion</span><span class="p">(</span><span class="n">cp</span><span class="o">.</span><span class="n">cspmatrix</span><span class="p">(</span><span class="n">symb</span><span class="p">)</span><span class="o">+</span><span class="n">Z2</span><span class="p">,</span> <span class="n">reordered</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">Y2</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">mrcompletion</span><span class="p">(</span><span class="n">cp</span><span class="o">.</span><span class="n">cspmatrix</span><span class="p">(</span><span class="n">symb</span><span class="p">)</span><span class="o">+</span><span class="n">Z2</span><span class="p">,</span> <span class="n">reordered</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p>The conversion can also be combined with clique-merging techniques in
the symbolic factorization. This typically yields a block-diagonal SDP
with fewer (but bigger) blocks than without clique-merging:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">mf</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">merge_size_fill</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
<span class="n">prob3</span><span class="p">,</span> <span class="n">blocks_to_sparse</span><span class="p">,</span> <span class="n">symbs</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">convert_conelp</span><span class="p">(</span><span class="o">*</span><span class="n">prob</span><span class="p">,</span> <span class="n">coupling</span> <span class="o">=</span> <span class="s1">&#39;full&#39;</span><span class="p">,</span> <span class="n">merge_function</span> <span class="o">=</span> <span class="n">mf</span><span class="p">)</span>
<span class="n">sol3</span> <span class="o">=</span> <span class="n">solvers</span><span class="o">.</span><span class="n">conelp</span><span class="p">(</span><span class="o">*</span><span class="n">prob3</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span>     <span class="n">pcost</span>       <span class="n">dcost</span>       <span class="n">gap</span>    <span class="n">pres</span>   <span class="n">dres</span>   <span class="n">k</span><span class="o">/</span><span class="n">t</span>
 <span class="mi">0</span><span class="p">:</span> <span class="o">-</span><span class="mf">8.2758e+00</span> <span class="o">-</span><span class="mf">2.9164e+02</span>  <span class="mi">6</span><span class="n">e</span><span class="o">+</span><span class="mi">02</span>  <span class="mi">6</span><span class="n">e</span><span class="o">-</span><span class="mi">01</span>  <span class="mi">2</span><span class="n">e</span><span class="o">+</span><span class="mi">00</span>  <span class="mi">1</span><span class="n">e</span><span class="o">+</span><span class="mi">00</span>
 <span class="mi">1</span><span class="p">:</span> <span class="o">-</span><span class="mf">1.8634e+01</span> <span class="o">-</span><span class="mf">8.0009e+01</span>  <span class="mi">8</span><span class="n">e</span><span class="o">+</span><span class="mi">01</span>  <span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">01</span>  <span class="mi">5</span><span class="n">e</span><span class="o">-</span><span class="mi">01</span>  <span class="mi">9</span><span class="n">e</span><span class="o">-</span><span class="mi">01</span>
 <span class="mi">2</span><span class="p">:</span> <span class="o">-</span><span class="mf">2.4495e+01</span> <span class="o">-</span><span class="mf">4.5428e+01</span>  <span class="mi">3</span><span class="n">e</span><span class="o">+</span><span class="mi">01</span>  <span class="mi">4</span><span class="n">e</span><span class="o">-</span><span class="mi">02</span>  <span class="mi">2</span><span class="n">e</span><span class="o">-</span><span class="mi">01</span>  <span class="mi">3</span><span class="n">e</span><span class="o">-</span><span class="mi">01</span>
 <span class="mi">3</span><span class="p">:</span> <span class="o">-</span><span class="mf">2.5371e+01</span> <span class="o">-</span><span class="mf">3.2361e+01</span>  <span class="mi">8</span><span class="n">e</span><span class="o">+</span><span class="mi">00</span>  <span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">02</span>  <span class="mi">6</span><span class="n">e</span><span class="o">-</span><span class="mi">02</span>  <span class="mi">5</span><span class="n">e</span><span class="o">-</span><span class="mi">02</span>
 <span class="mi">4</span><span class="p">:</span> <span class="o">-</span><span class="mf">2.5903e+01</span> <span class="o">-</span><span class="mf">2.8828e+01</span>  <span class="mi">3</span><span class="n">e</span><span class="o">+</span><span class="mi">00</span>  <span class="mi">6</span><span class="n">e</span><span class="o">-</span><span class="mi">03</span>  <span class="mi">2</span><span class="n">e</span><span class="o">-</span><span class="mi">02</span>  <span class="mi">2</span><span class="n">e</span><span class="o">-</span><span class="mi">02</span>
 <span class="mi">5</span><span class="p">:</span> <span class="o">-</span><span class="mf">2.6226e+01</span> <span class="o">-</span><span class="mf">2.6782e+01</span>  <span class="mi">6</span><span class="n">e</span><span class="o">-</span><span class="mi">01</span>  <span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">03</span>  <span class="mi">5</span><span class="n">e</span><span class="o">-</span><span class="mi">03</span>  <span class="mi">3</span><span class="n">e</span><span class="o">-</span><span class="mi">03</span>
 <span class="mi">6</span><span class="p">:</span> <span class="o">-</span><span class="mf">2.6275e+01</span> <span class="o">-</span><span class="mf">2.6391e+01</span>  <span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">01</span>  <span class="mi">2</span><span class="n">e</span><span class="o">-</span><span class="mi">04</span>  <span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">03</span>  <span class="mi">6</span><span class="n">e</span><span class="o">-</span><span class="mi">04</span>
 <span class="mi">7</span><span class="p">:</span> <span class="o">-</span><span class="mf">2.6289e+01</span> <span class="o">-</span><span class="mf">2.6308e+01</span>  <span class="mi">2</span><span class="n">e</span><span class="o">-</span><span class="mi">02</span>  <span class="mi">4</span><span class="n">e</span><span class="o">-</span><span class="mi">05</span>  <span class="mi">2</span><span class="n">e</span><span class="o">-</span><span class="mi">04</span>  <span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">04</span>
 <span class="mi">8</span><span class="p">:</span> <span class="o">-</span><span class="mf">2.6291e+01</span> <span class="o">-</span><span class="mf">2.6294e+01</span>  <span class="mi">3</span><span class="n">e</span><span class="o">-</span><span class="mi">03</span>  <span class="mi">6</span><span class="n">e</span><span class="o">-</span><span class="mi">06</span>  <span class="mi">2</span><span class="n">e</span><span class="o">-</span><span class="mi">05</span>  <span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">05</span>
 <span class="mi">9</span><span class="p">:</span> <span class="o">-</span><span class="mf">2.6291e+01</span> <span class="o">-</span><span class="mf">2.6292e+01</span>  <span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">03</span>  <span class="mi">2</span><span class="n">e</span><span class="o">-</span><span class="mi">06</span>  <span class="mi">7</span><span class="n">e</span><span class="o">-</span><span class="mi">06</span>  <span class="mi">4</span><span class="n">e</span><span class="o">-</span><span class="mi">06</span>
<span class="mi">10</span><span class="p">:</span> <span class="o">-</span><span class="mf">2.6291e+01</span> <span class="o">-</span><span class="mf">2.6291e+01</span>  <span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">04</span>  <span class="mi">2</span><span class="n">e</span><span class="o">-</span><span class="mi">07</span>  <span class="mi">7</span><span class="n">e</span><span class="o">-</span><span class="mi">07</span>  <span class="mi">4</span><span class="n">e</span><span class="o">-</span><span class="mi">07</span>
<span class="mi">11</span><span class="p">:</span> <span class="o">-</span><span class="mf">2.6291e+01</span> <span class="o">-</span><span class="mf">2.6291e+01</span>  <span class="mi">9</span><span class="n">e</span><span class="o">-</span><span class="mi">06</span>  <span class="mi">2</span><span class="n">e</span><span class="o">-</span><span class="mi">08</span>  <span class="mi">7</span><span class="n">e</span><span class="o">-</span><span class="mi">08</span>  <span class="mi">4</span><span class="n">e</span><span class="o">-</span><span class="mi">08</span>
<span class="n">Optimal</span> <span class="n">solution</span> <span class="n">found</span><span class="o">.</span>
</pre></div>
</div>
<p>Finally, we recover the solution to the original SDP:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="c1"># Map block-diagonal solution sol2[&#39;z&#39;] to a sparse positive semidefinite completable matrix</span>
<span class="n">blki</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">J</span><span class="p">,</span><span class="n">bn</span> <span class="o">=</span> <span class="n">blocks_to_sparse</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">Z3</span> <span class="o">=</span> <span class="n">spmatrix</span><span class="p">(</span><span class="n">sol3</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">][</span><span class="n">blki</span><span class="p">],</span><span class="n">I</span><span class="p">,</span><span class="n">J</span><span class="p">)</span>

<span class="c1"># Compute completion</span>
<span class="n">symb</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">symbolic</span><span class="p">(</span><span class="n">Z3</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">cp</span><span class="o">.</span><span class="n">maxcardsearch</span><span class="p">)</span>
<span class="n">Z3c</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">psdcompletion</span><span class="p">(</span><span class="n">cp</span><span class="o">.</span><span class="n">cspmatrix</span><span class="p">(</span><span class="n">symb</span><span class="p">)</span><span class="o">+</span><span class="n">Z3</span><span class="p">,</span> <span class="n">reordered</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="euclidean-distance-matrix-completion">
<h2>Euclidean distance matrix completion<a class="headerlink" href="#euclidean-distance-matrix-completion" title="Permalink to this headline">¶</a></h2>
<p>Suppose that <span class="math">\(A\)</span> is a partial EDM of order <span class="math">\(n\)</span> where the
squared distance <span class="math">\(A_{ij} = \| p_i - p_j \|_2^2\)</span> between two point
<span class="math">\(p_i\)</span> and <span class="math">\(p_j\)</span> is known if <span class="math">\(p_i\)</span> and <span class="math">\(p_j\)</span> are
sufficiently close. We will assume that <span class="math">\(A_{ij}\)</span> is known if and
only if</p>
<div class="math">
\[\| p_i - p_j \|_2^2 \leq \delta\]</div>
<p>where <span class="math">\(\delta\)</span> is a positive constant. Let us generate a random
partial EDM based on points in <span class="math">\(\mathbb{R}^2\)</span>:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">cvxopt</span> <span class="k">import</span> <span class="n">uniform</span><span class="p">,</span> <span class="n">spmatrix</span><span class="p">,</span> <span class="n">matrix</span>
<span class="kn">import</span> <span class="nn">chompack</span> <span class="k">as</span> <span class="nn">cp</span>

<span class="n">d</span> <span class="o">=</span> <span class="mi">2</span>              <span class="c1"># dimension</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">100</span>            <span class="c1"># number of points (order of A)</span>
<span class="n">delta</span> <span class="o">=</span> <span class="mf">0.15</span><span class="o">**</span><span class="mi">2</span>    <span class="c1"># distance threshold</span>

<span class="n">P</span> <span class="o">=</span> <span class="n">uniform</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>   <span class="c1"># generate n points with independent and uniformly distributed coordinates</span>
<span class="n">Y</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">T</span><span class="o">*</span><span class="n">P</span>          <span class="c1"># Gram matrix</span>

<span class="c1"># Compute true distances:  At[i,j] = norm(P[:,i]-P[:,j])**2</span>
<span class="c1">#   At = diag(Y)*ones(1,n) + ones(n,1)*diag(Y).T - 2*Y</span>
<span class="n">At</span> <span class="o">=</span> <span class="n">Y</span><span class="p">[::</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">matrix</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,(</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="p">))</span> <span class="o">+</span> <span class="n">matrix</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,(</span><span class="n">n</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span><span class="o">*</span><span class="n">Y</span><span class="p">[::</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">T</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">Y</span>

<span class="c1"># Generate matrix with &quot;observable distances&quot;</span>
<span class="c1">#   A[i,j] = At[i,j] if At[i,j] &lt;= delta</span>
<span class="n">V</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">J</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="p">[(</span><span class="n">At</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">],</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">n</span><span class="p">)</span> <span class="k">if</span> <span class="n">At</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">delta</span><span class="p">])</span>
<span class="n">A</span> <span class="o">=</span> <span class="n">spmatrix</span><span class="p">(</span><span class="n">V</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">J</span><span class="p">,(</span><span class="n">n</span><span class="p">,</span><span class="n">n</span><span class="p">))</span>
</pre></div>
</div>
<p>The partial EDM <span class="math">\(A\)</span> may or may not be chordal. We can find a
maximal chordal subgraph using the <code class="docutils literal"><span class="pre">maxchord</span></code> routine which returns a
chordal matrix <span class="math">\(A_{\mathrm{c}}\)</span> and a perfect elimination order
<span class="math">\(p\)</span>. Note that if <span class="math">\(A\)</span> is chordal, then
<span class="math">\(A_{\mathrm{c}} = A\)</span>.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">Ac</span><span class="p">,</span><span class="n">p</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">maxchord</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
</pre></div>
</div>
<p>The points <span class="math">\(p_i\)</span> and the known distances can be visualized using
Matplotlib:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pylab</span> <span class="k">import</span> <span class="n">plot</span><span class="p">,</span><span class="n">xlim</span><span class="p">,</span><span class="n">ylim</span><span class="p">,</span><span class="n">gca</span>

<span class="c1"># Extract entries in Ac and entries dropped from A</span>
<span class="n">IJc</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">Ac</span><span class="o">.</span><span class="n">I</span><span class="p">,</span><span class="n">Ac</span><span class="o">.</span><span class="n">J</span><span class="p">)</span>
<span class="n">tmp</span> <span class="o">=</span> <span class="n">A</span> <span class="o">-</span> <span class="n">Ac</span>
<span class="n">IJd</span> <span class="o">=</span> <span class="p">[(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">tmp</span><span class="o">.</span><span class="n">I</span><span class="p">,</span><span class="n">tmp</span><span class="o">.</span><span class="n">J</span><span class="p">,</span><span class="n">tmp</span><span class="o">.</span><span class="n">V</span><span class="p">)</span> <span class="k">if</span> <span class="n">v</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>

<span class="c1"># Plot edges</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span> <span class="ow">in</span> <span class="n">IJc</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="n">j</span><span class="p">:</span> <span class="n">plot</span><span class="p">([</span><span class="n">P</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">i</span><span class="p">],</span><span class="n">P</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">j</span><span class="p">]],[</span><span class="n">P</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">],</span><span class="n">P</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">]],</span><span class="s1">&#39;k-&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span> <span class="ow">in</span> <span class="n">IJd</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="n">j</span><span class="p">:</span> <span class="n">plot</span><span class="p">([</span><span class="n">P</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">i</span><span class="p">],</span><span class="n">P</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">j</span><span class="p">]],[</span><span class="n">P</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">],</span><span class="n">P</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">]],</span><span class="s1">&#39;r-&#39;</span><span class="p">)</span>

<span class="c1"># Plot points</span>
<span class="n">plot</span><span class="p">(</span><span class="n">P</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">P</span><span class="p">[</span><span class="mi">1</span><span class="p">,:]</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="s1">&#39;b.&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">xlim</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span><span class="mf">1.</span><span class="p">])</span>
<span class="n">ylim</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span><span class="mf">1.</span><span class="p">])</span>
<span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="_images/examples_20_0.png" src="_images/examples_20_0.png" />
<p>The edges represent known distances. The red edges are edges that were
removed to produce the maximal chordal subgraph, and the black edges are
the edges of the chordal subgraph.</p>
<p>Next we compute a symbolic factorization of the chordal matrix
<span class="math">\(A_{\mathrm{c}}\)</span> using the perfect elimination order <span class="math">\(p\)</span>:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">symb</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">symbolic</span><span class="p">(</span><span class="n">Ac</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">)</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">symb</span><span class="o">.</span><span class="n">p</span>
</pre></div>
</div>
<p>Now <code class="docutils literal"><span class="pre">edmcompletion</span></code> can be used to compute an EDM completion of the
chordal matrix <span class="math">\(A_{\mathrm{c}}\)</span>:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">X</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">edmcompletion</span><span class="p">(</span><span class="n">cp</span><span class="o">.</span><span class="n">cspmatrix</span><span class="p">(</span><span class="n">symb</span><span class="p">)</span><span class="o">+</span><span class="n">Ac</span><span class="p">,</span> <span class="n">reordered</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="symbolic-factorization">
<h2>Symbolic factorization<a class="headerlink" href="#symbolic-factorization" title="Permalink to this headline">¶</a></h2>
<p>This example demonstrates the symbolic factorization. We start by
generating a test problem and computing a symbolic factorization using
the approximate minimum degree (AMD) ordering heuristic:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">chompack</span> <span class="k">as</span> <span class="nn">cp</span>
<span class="kn">from</span> <span class="nn">cvxopt</span> <span class="k">import</span> <span class="n">spmatrix</span><span class="p">,</span> <span class="n">amd</span>

<span class="n">L</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">14</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">14</span><span class="p">],[</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">14</span><span class="p">],[</span><span class="mi">4</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">15</span><span class="p">],[</span><span class="mi">5</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">15</span><span class="p">],[</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">14</span><span class="p">],[</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">14</span><span class="p">],[</span><span class="mi">8</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">15</span><span class="p">],[</span><span class="mi">9</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">16</span><span class="p">],[</span><span class="mi">10</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">16</span><span class="p">],[</span><span class="mi">11</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">16</span><span class="p">],[</span><span class="mi">12</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">16</span><span class="p">],[</span><span class="mi">13</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">16</span><span class="p">],[</span><span class="mi">14</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">16</span><span class="p">],[</span><span class="mi">15</span><span class="p">,</span><span class="mi">16</span><span class="p">],[</span><span class="mi">16</span><span class="p">]]</span>
<span class="n">I</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">J</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">l</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">L</span><span class="p">):</span>
    <span class="n">I</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
    <span class="n">J</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>

<span class="n">A</span> <span class="o">=</span> <span class="n">spmatrix</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">J</span><span class="p">,(</span><span class="mi">17</span><span class="p">,</span><span class="mi">17</span><span class="p">))</span>
<span class="n">symb</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">symbolic</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">amd</span><span class="o">.</span><span class="n">order</span><span class="p">)</span>
</pre></div>
</div>
<p>The sparsity graph can be visualized with the <code class="docutils literal"><span class="pre">sparsity_graph</span></code> routine
if Matplotlib, NetworkX, and Graphviz are installed:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">chompack.pybase.plot</span> <span class="k">import</span> <span class="n">sparsity_graph</span>
<span class="n">sparsity_graph</span><span class="p">(</span><span class="n">symb</span><span class="p">,</span> <span class="n">node_size</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">with_labels</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<img alt="_images/examples_30_0.png" src="_images/examples_30_0.png" />
<p>The <code class="docutils literal"><span class="pre">sparsity_graph</span></code> routine passes all optional keyword arguments to
NetworkX to make it easy to customize the visualization.</p>
<p>It is also possible to visualize the sparsity pattern using the <code class="docutils literal"><span class="pre">spy</span></code>
routine which requires the packages Matplotlib, Numpy, and Scipy:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">chompack.pybase.plot</span> <span class="k">import</span> <span class="n">spy</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">spy</span><span class="p">(</span><span class="n">symb</span><span class="p">,</span> <span class="n">reordered</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<img alt="_images/examples_32_0.png" src="_images/examples_32_0.png" />
<p>The supernodes and the supernodal elimination tree can be extracted from
the symbolic factorization as follows:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">par</span> <span class="o">=</span> <span class="n">symb</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span>
<span class="n">snodes</span> <span class="o">=</span> <span class="n">symb</span><span class="o">.</span><span class="n">supernodes</span><span class="p">()</span>

<span class="nb">print</span> <span class="s2">&quot;Id  Parent id  Supernode&quot;</span>
<span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">sk</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">snodes</span><span class="p">):</span>
    <span class="nb">print</span> <span class="s2">&quot;</span><span class="si">%2i</span><span class="s2">     </span><span class="si">%2i</span><span class="s2">     &quot;</span><span class="o">%</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">par</span><span class="p">[</span><span class="n">k</span><span class="p">]),</span> <span class="n">sk</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Id</span>  <span class="n">Parent</span> <span class="nb">id</span>  <span class="n">Supernode</span>
 <span class="mi">0</span>      <span class="mi">4</span>      <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
 <span class="mi">1</span>      <span class="mi">2</span>      <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
 <span class="mi">2</span>      <span class="mi">4</span>      <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
 <span class="mi">3</span>      <span class="mi">4</span>      <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span>
 <span class="mi">4</span>      <span class="mi">5</span>      <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span>
 <span class="mi">5</span>      <span class="mi">7</span>      <span class="p">[</span><span class="mi">9</span><span class="p">]</span>
 <span class="mi">6</span>      <span class="mi">7</span>      <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">]</span>
 <span class="mi">7</span>      <span class="mi">7</span>      <span class="p">[</span><span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">16</span><span class="p">]</span>
</pre></div>
</div>
<p>The supernodal elimination tree can be visualized with the
<code class="docutils literal"><span class="pre">etree_graph</span></code> routine if Matplotlib, NetworkX, and Graphviz are
installed:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">chompack.pybase.plot</span> <span class="k">import</span> <span class="n">etree_graph</span>
<span class="n">etree_graph</span><span class="p">(</span><span class="n">symb</span><span class="p">,</span> <span class="n">with_labels</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">arrows</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">node_size</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">node_color</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">node_shape</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="n">font_size</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
</pre></div>
</div>
<img alt="_images/examples_36_0.png" src="_images/examples_36_0.png" />
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="documentation.html" class="btn btn-neutral" title="Documentation"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2014-2016, Martin S. Andersen and Lieven Vandenberghe.
    </p>
  </div>

  <a href="https://github.com/snide/sphinx_rtd_theme">Sphinx theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'2.3.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>